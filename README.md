# 2cUTC_dissectors

A set of Wireshark .lua scripts to dissect 2cUTC CTRACEs (from z/OS)

**WHAT IS A 2cUTC CTRACE?**

If you want to know more about 2cUTC: Visit [https://2cutc.ansynova.eu/](https://2cutc.ansynova.eu/)

If you want to know more about AnSyNova GmbH: [https://www.ansynova.com/](https://www.ansynova.com/)

**PREREQUISITES**

You need Wireshark on your PC. Your goal is to analyze .pcapng trace files produced by 2cUTC on this PC or from somewhere else, which contain exported (from z/OS) CTRACEs. You do not need to install any of the drivers and capabilites that enable you to actually perform any real-time tracing.

One feature, the dissection of SYSTCPIP Option "TCP" data, works best with a wireshark version **after or including** **Wireshark version 4.2.0**, which contains a fix submitted by us that was needed to display embedded IP and TCP headers correctly.

**PREPARATION**

To get these dissectors onto your PC:

Use the CODE button **Download ZIP**, or clone the repo onto a location on your PC (you could even choose the Wireshark plugins folder as that location, to avoid needing a copy operation). 

_OR_

If you intend to contribute to these dissectors or suggest modifications via pull requests, consider forking this repo to your own user and then clone that one instead. 

**INSTALL**

For these dissectors to be active in Wireshark,

_FIRST_

copy these luas to `C:\Users\<username>\AppData\Roaming\Wireshark\plugins`

Note: If you do not copy these luas into the plugins directory, then the following
steps where you refer to "2cutc" as a dissector when setting a User DLT will result
in an error when Wireshark is started.

Note: The following steps ("EITHER", or "OR") are no longer needed. 2cUTC will use
"-o ""uat:user_dlts:\""User 0 (DLT=147)\"",\""2cutc\"",\""0\"",\""\"",\""0\"",\""\"""""
as start option for wireshark.exe to set the USER_DLT 147 to "2cutc" automagically.
If this for some reason fails, you may of course use the following instructions to
set them manually.

_THEN **EITHER**_

go to WireShark / Options / Protocols and select DLT-USER - Add an entry to the table  with DLT=147.
In this entry, set Payload Protocol to "2cutc", set Header Size to 0, Header Protocol to empty, Trailer Size to 0, and Trailer Protocol to empty

_**OR**_

create (or edit) a file "`user_dlts`" in your wirshark profile and create (or add) an entry with the following contents:

```
# This file is automatically generated, DO NOT MODIFY.
"User 0 (DLT=147)","2cutc","0","","0",""
```

_and FINALLY_

bring up Wireshark.

**ISSUES**

If you encounter difficulties, bugs or have suggestions, you can open issues in this repo.

**EXAMPLE COLORING RULE**

Since all aspects of the lua dissectors are available as fields, it is easy to produce a single coloring rule to hilight
trace records that are considered detrimental:

```
# This file was created by Wireshark. Edit with care.
@SYSTCPIP Bad ENTID@2cutc.component == "SYSTCPIP" && systcpip.flag == "!"@[65535,21845,0][65535,65535,65535]
```

**EXAMPLE FILTER STATEMENT**

In a similar way to coloring rules, you may use the fields for filtering the trace records.

```
2cutc.component == "SYSTCPIP" && systcpip.flag == "!"
```

**SPECIAL FIELD "2cutc.info"**

This field is "created" and "filled" by the 2cutc POST-DISSECTOR.

Here's how this works:

Any upper dissector may have fields that can be used to indicate special information. The post-dissector can be used to access these fields and can then decide to populate the "2cutc.info" field, which is initially empty.

You may make the `2cutc.info` field visible in the trace by defining a _(new)_ custom column using `2cutc.info` as field name.

**NOTES**

You can now access fields like "2cutc.info", "systcpip.option" and others from the coloring syntax, the filtering syntax and also when defining columns to display.

You can derive the available fields by looking at the INIT section of the lua dissectors (and post-dissectors) supplied here.
